<html>
    <head>
        <style>
            * {
                font-family: "Comic Sans MS", 標楷體;
            }
            ::-webkit-scrollbar-track{
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
                border-radius: 10px;
                background-color: #333333;
            }
            ::-webkit-scrollbar-thumb {
                cursor: default;
                background-color: #a1a1a1;
                border-radius: 10px;
            }
            ::-webkit-scrollbar-thumb:hover {
                background-color: #888888;
            }
            ::-webkit-scrollbar {
                width: 10px;
                height: 10px;
            }
            body {
                background-color: #181818;
                color:#e8e8e8;
            }
            .di{
                display: flex;
                justify-content: center;
            }
        </style>
    </head>
    <body>
        <div class="di">
            <canvas id="cvs" width="2000" height="3000"></canvas>
        </div>
        <script>
var cvs=document.querySelector("#cvs");
var ctx=cvs.getContext("2d");
var sht=5,peo=[],ttl=0,ttl1=0,
    br=100,br1=10,h=0,vy,aa,cy,by,
    ck=1,slp,keys=[],line=3,fps=120;
pd={
    3:['g','h','j'],
    4:['f','g','h','j'],
    5:['d','f','gh','j','k'],
    6:['d','f','g','h','j','k']
};
cvs.style.height=`${innerHeight*(outerWidth/innerWidth)*0.95}px`;
document.onkeydown=(e)=>{
    if(ck==1){
        for(let i=0;i<line;i++){
            if(pd[line][i].includes(e.key)){
                keys.push(i);
            }
        }
    }
};
function test(bt){
    let a=1;
    for(let i=0;i<line;i++){
        if(peo[0]==i&&bt==i){
            peo.splice(0, 1);
            peo.push(Math.floor(Math.random()*line));
            ttl1++;
            a=0;
        }
    }
    keys.splice(0,1);
    if(a)err();
    else h+=cvs.height*0.6/Math.max(sht,line);
}
function err(){
    ck=0;
    h=0;
    aa=peo[0];
    delete peo[0];
    slp=(parseInt(ttl1/50)+1)*fps/12;
    ay=3;
    vy=-ay*slp;
    cy=((cvs.height*0.65-sht*br1)/sht+br1)*sht-cvs.height*0.04+cvs.height*0.08-h;
    by=cy;
}
function per(){
    peo=[];
    for(let i=0;i<sht;i++){
        peo.push(`${Math.floor(Math.random()*line)}`);
    }
}
function bk(){
    ctx.clearRect(0,0,cvs.width,cvs.height);
    ctx.save();
    ctx.fillStyle="#181818";
    ctx.fillRect(0,0,cvs.width,cvs.height);
    ctx.restore();
}
function draw(){
    for(let i=1;i<=line;i++){
        ctx.fillStyle="#666";
        ctx.beginPath();
        ctx.arc(((cvs.width-(line+1)*br)/(line*2)+br/2)*(i*2-1)+br/2,
                cvs.height*0.85,
                cvs.height*0.1*3/line,
                0,Math.PI*2);
        ctx.fill();
    }
    for(let i=1;i<=line;i++){
        ctx.fillStyle = "#ff0";
        ctx.font = `${175*3/line}px arial`;
        ctx.textAlign = "center";
        ctx.fillText("Shoot!",((cvs.width-(line+1)*br)/(line*2)+br/2)*(i*2-1)+br/2,cvs.height*0.87-4*line);
    }
    for(let i=1;i<=line;i++){
        ctx.fillStyle = "#0ff";
        ctx.font = `${120*3/line}px arial`;
        ctx.textAlign = "center";
        ctx.fillText(pd[line][i-1],((cvs.width-(line+1)*br)/(line*2)+br/2)*(i*2-1)+br/2,cvs.height*0.87-4*line+175*3/line);
    }
    //------------------------------------------------------
    for(let i=0;i<sht;i++){//shtm
        ctx.beginPath();
        ctx.arc(((cvs.width-(line+1)*br)/(line*2)+br/2)*(peo[i]*2+1)+br/2,
                ((cvs.height*0.65-sht*br1)/sht+br1)*(sht-i)-cvs.height*0.04+cvs.height*0.08-h,
                cvs.height*0.6/Math.max(sht,line)/2,
                0,Math.PI*2);
        ctx.fillStyle="#c85656";
        ctx.fill();
    }
    //------------------------------------------------------
    ctx.fillStyle="black";
    ctx.fillRect(0,0,cvs.width,cvs.height*0.1);
    //------------------------------------------------------
    let gdt=ctx.createLinearGradient(0,0,cvs.width,cvs.height);
    gdt.addColorStop(1,"#f00");
    gdt.addColorStop(0,"#f0f");
    ctx.strokeStyle=gdt;
    ctx.lineWidth=10;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo(0,cvs.height);
    ctx.lineTo(cvs.width,cvs.height);
    ctx.lineTo(cvs.width,0);
    ctx.lineTo(0,0);
    ctx.stroke();
    ctx.closePath();
}
function dw(i,a){
    setTimeout(()=>{
        bk();
        draw();
        ctx.beginPath();
        ctx.arc(((cvs.width-(line+1)*br)/(line*2)+br/2)*(a*2+1)+br/2,
                ((cvs.height*0.65-sht*br1)/sht+br1)*(sht-0)-cvs.height*0.04+cvs.height*0.08-(i*2+1)*cvs.height*0.0018,
                cvs.height*0.6/Math.max(sht,line)/2,
                0,Math.PI*2);  
        ctx.shadowColor = "#000";
        ctx.shadowBlur = 15;
        ctx.fillStyle="#c85656";
        ctx.fill();
        ctx.shadowColor = "#0000";
        ctx.shadowBlur = 0;
    },slp);
}
function drop(){
    setInterval(()=>{
        if(h<0){
            h=0;
            bk();
            draw();
        }
        if(h>0){
            h-=cvs.height*0.6/Math.max(sht,line)/fps*8;
            bk();
            draw();
        }
        if(h>cvs.height*0.6/Math.max(sht,line)/2){
            h-=cvs.height*0.6/Math.max(sht,line)/fps*6;
        }
        if(ck){
            if(keys.length>0){
                test(keys[0]);
            }
        }
        else{
            if(cy>by){
                peo[0]=aa;
                keys=[];
                ck=1;
                cy=by;
            }
            bk();
            draw();
            ctx.beginPath();
            ctx.arc(((cvs.width-(line+1)*br)/(line*2)+br/2)*(aa*2+1)+br/2,
                    cy,
                    cvs.height*0.6/Math.max(sht,line)/2,
                    0,Math.PI*2);
            ctx.shadowColor = "#000";
            ctx.shadowBlur = 15;
            ctx.fillStyle="#c85656";
            ctx.fill();
            ctx.shadowColor = "#0000";
            ctx.shadowBlur = 0;
            cy+=vy;
            vy+=ay;
        }
    },1/fps*1000);
}
per();
bk();
draw();
drop();
        </script>
    </body>
</html>
